# Скрипты для мониторинга USB через UDEV 

Нужны для того, чтобы отсылать сведения о подключаемых и извлекаемых устройствах на сервер логирования. 
Вместе со скриптами лежить бинарник curl на случай если его нет в системе.

## Где применимо?

В сети построенной на тонких клиентах и подключаемых к серверу по протоколу RDP. Предполагается что для этого ТК использует freerdp или rdescktop.
В случае необходимости контроля за подключаемыми устройствами и реагиования на подключение запрещенных устройств.( В случае подключения носителей по RDP на сервер не передается информация о серийном номере устройста и т.д. )

### Со скриптами

На сервер передатеся в виде POST запроса следующая информация:
* тип устройства
* производитель
* серийный номер
* имя пользователя RDP
* имя хоста (ТК)

## Требования

* Версия linux с udev
* Служба слушающая передаваемые curl сведения

## Установка

1. Для установки копируем все файлы на флешку в папку mountScripts которая должна быть в корне. 
1. В файле config.sh меняем во второй строчке название флешки на свою `cp -R /media/USB_NAME/mountScripts ./`
1. Делаем config.sh выполняем `chmod +x config.sh`
1. В файле curl.sh меняем переменную SERVER_URL на свой POST endpoint
1. Выполняем скрипт `sh config.sh`

## Как работает

Скрипт реагирует на действия вставки и извлечения устройства и запускает либо скрипт curl.sh либо curl-inject.sh. Сами по себе эти скрипты только и делают что вызывают curl-aсtion.sh и curl-inject-action.sh. Такая отвязка udev скрипта от фактических действий curl нужна так как curl ожидает ответа сервера в формате true\false, что означает наличие\отсутствие устройства в белом списке, и выполняет какие либо действия, например выключить компьютер при вставке нелегитимного устройства.
*По умолчанию никаких действий при вставке запрещенного устройства не производит, для  выключения устройства нужно раскоментировать строку #shutdown now*